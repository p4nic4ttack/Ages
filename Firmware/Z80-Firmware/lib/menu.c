#include <menu.h>

uint8_t menu_fb[256] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
uint8_t menu_img[252] = {0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0xfc, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0xfc, 0x04, 0x04, 0x04, 0x04, 0x0c, 0x44, 0x64, 0x64, 0x44, 0x0c, 0x44, 0x64, 0x64, 0x44, 0x0c, 0x44, 0x64, 0x64, 0x44, 0x0c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3e, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x00, 0x00, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xf8, 0x98, 0x98, 0x98, 0x18, 0x18, 0x18, 0x3c, 0x3c, 0x18, 0x00, 0x00, 0x28, 0x64, 0x7c, 0x38, 0x7e, 0x7d, 0x28, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x06, 0x07, 0x66, 0x60, 0x00, 0x06, 0x07, 0x06, 0x00, 0x00, 0x06, 0x07, 0x06, 0x00, 0x00, 0x06, 0x07, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0f, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x19, 0x19, 0x19, 0x1f, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x18, 0x18, 0x18, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
static const uint8_t triangle[] = {0x7C, 0x38, 0x10};
static const uint8_t empty_triangle[] = {0x00, 0x00, 0x00};
void init_menu(Menu *menu){
	lcd_out_char(0xff);
	menu->choice = 0;
	menu->chosen_item = 100;
	menu->lcd_drawn = false;
}

void draw_menu(Menu *menu){
	if(menu->choice == 0){
		menu_fb[17] = 0xff;
		menu_fb[45] = 0xff;
		menu_fb[46] = 0xff;
		menu_fb[49] = 0xff;
		menu_fb[110] = 0x00;
		menu_fb[113] = 0x00;
		menu_fb[114] = 0x00;
		menu_fb[142] = 0x00;
		menu_fb[206] = 0x00;
		menu_fb[209] = 0x00;
		menu_fb[210] = 0x00;
		menu_fb[238] = 0x00;
		clear_framebuffer();
		update_framebuffer(menu_fb);
	}
	else if(menu->choice == 1){
		menu_fb[17] = 0x00;
		menu_fb[45] = 0x00;
		menu_fb[46] = 0x00;
		menu_fb[49] = 0x00;
		menu_fb[110] = 0xff;
		menu_fb[113] = 0xff;
		menu_fb[114] = 0xff;
		menu_fb[142] = 0xff;
		menu_fb[206] = 0x00;
		menu_fb[209] = 0x00;
		menu_fb[210] = 0x00;
		menu_fb[238] = 0x00;
		clear_framebuffer();
		update_framebuffer(menu_fb);
	}
	else if(menu->choice == 2){
		menu_fb[17] = 0x00;
		menu_fb[45] = 0x00;
		menu_fb[46] = 0x00;
		menu_fb[49] = 0x00;
		menu_fb[110] = 0x00;
		menu_fb[113] = 0x00;
		menu_fb[114] = 0x00;
		menu_fb[142] = 0x00;
		menu_fb[206] = 0xff;
		menu_fb[209] = 0xff;
		menu_fb[210] = 0xff;
		menu_fb[238] = 0xff;
		clear_framebuffer();
		update_framebuffer(menu_fb);
	}
	if(!menu->lcd_drawn){

		set_x(0);
		set_y(3);
		for(uint16_t i = 0; i < 252; i++){
			lcd_data_byte(menu_img[i]);
		}
		set_x(0);
		set_y(0);
		if(menu->choice == 0){
			lcd_draw(empty_triangle, 0, 1, 3);
			lcd_draw(empty_triangle, 0, 2, 3);
			lcd_draw(triangle, 0, 0, 3);
		}
		else if(menu->choice == 1){
			lcd_draw(empty_triangle, 0, 0, 3);
			lcd_draw(empty_triangle, 0, 2, 3);
			lcd_draw(triangle, 0, 1, 3);
		}else if(menu->choice == 2){
			lcd_draw(empty_triangle, 0, 0, 3);
			lcd_draw(empty_triangle, 0, 1, 3);
			lcd_draw(triangle, 0, 2, 3);
		}	

		lcd_out_str("1.Snake", 10, 0);
		lcd_out_str("2.Brick br.", 10, 1);
		lcd_out_str("3.Pong", 10, 2);
		set_x(0);
		set_y(0);
		menu->lcd_drawn = true;
	}
}

void get_menu_input(Menu *menu){
	ButtonState m_up = up_pressed();
	ButtonState m_down = dwn_pressed();
	ButtonState m_a = a_pressed();
	if(m_up == BTN_PRESSED || m_up == BTN_HOLD){
		if(menu->choice > 0){
			menu->choice--;
			menu->lcd_drawn = false;
		}
	}
	if(m_down == BTN_PRESSED || m_down == BTN_HOLD){
		if(menu->choice < 2){
			menu->choice++;
			menu->lcd_drawn = false;
		}
	}
	if(m_a == BTN_PRESSED || m_a == BTN_HOLD){
		menu->chosen_item = menu->choice;
	}
	for(uint8_t i = 0; i < 20; i++)
		delay1ms();
}